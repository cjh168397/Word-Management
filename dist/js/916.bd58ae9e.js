"use strict";(self["webpackChunkbig_event"]=self["webpackChunkbig_event"]||[]).push([[916],{6108:function(t,e,s){s.r(e),s.d(e,{default:function(){return m}});var a=function(){var t=this,e=t._self._c;return e("div",[e("el-card",{staticClass:"box-card"},[e("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[e("span",[t._v("文章列表")])]),e("div",{staticClass:"search-box"},[e("el-form",{attrs:{inline:!0,model:t.q}},[e("el-form-item",{attrs:{label:"文章分类"}},[e("el-select",{attrs:{placeholder:"请选择分类",size:"small"},model:{value:t.q.cate_id,callback:function(e){t.$set(t.q,"cate_id",e)},expression:"q.cate_id"}},t._l(t.cateList,(function(t){return e("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1),e("el-form-item",{staticStyle:{"margin-left":"15px"},attrs:{label:"发布状态"}},[e("el-select",{attrs:{placeholder:"请选择状态",size:"small"},model:{value:t.q.state,callback:function(e){t.$set(t.q,"state",e)},expression:"q.state"}},[e("el-option",{attrs:{label:"已发布",value:"已发布"}}),e("el-option",{attrs:{label:"草稿",value:"草稿"}})],1)],1),e("el-form-item",[e("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.initArtListFn}},[t._v("筛选")]),e("el-button",{attrs:{type:"info",size:"small"},on:{click:t.resetListFn}},[t._v("重置")])],1)],1),e("el-button",{staticClass:"btn-pub",attrs:{type:"primary",size:"small"},on:{click:t.showPubDialogFn}},[t._v("发表文章")])],1),e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.artList,border:"",stripe:""}},[e("el-table-column",{attrs:{label:"文章标题"},scopedSlots:t._u([{key:"default",fn:function({row:s}){return[e("el-link",{attrs:{type:"primary"},on:{click:function(e){return t.showDetailFn(s.title)}}},[t._v(" "+t._s(s.title)+" ")])]}}])}),e("el-table-column",{attrs:{label:"分类",prop:"name"}}),e("el-table-column",{attrs:{label:"发表时间",prop:"pub_date"},scopedSlots:t._u([{key:"default",fn:function({row:s}){return[e("span",[t._v(t._s(t.$formatDate(s.pub_date)))])]}}])}),e("el-table-column",{attrs:{label:"状态",prop:"state"}}),e("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function({row:s}){return[e("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(e){return t.removeFn(s.title)}}},[t._v("删除")])]}}])})],1),e("el-pagination",{attrs:{"current-page":t.q.pagenum,"page-sizes":[2,3,5,10],"page-size":t.q.pagesize,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChangeFn,"current-change":t.handleCurrentChangeFn,"update:currentPage":function(e){return t.$set(t.q,"pagenum",e)},"update:current-page":function(e){return t.$set(t.q,"pagenum",e)},"update:pageSize":function(e){return t.$set(t.q,"pagesize",e)},"update:page-size":function(e){return t.$set(t.q,"pagesize",e)}}}),e("el-dialog",{attrs:{title:"发表文章",visible:t.pubDialogVisible,fullscreen:"","before-close":t.handleClose},on:{"update:visible":function(e){t.pubDialogVisible=e},closed:t.onDialogClosedFn}},[e("el-form",{ref:"pubFormRef",attrs:{model:t.pubForm,rules:t.pubFormRules,"label-width":"100px"}},[e("el-form-item",{attrs:{label:"文章标题",prop:"title"}},[e("el-input",{attrs:{placeholder:"请输入标题"},model:{value:t.pubForm.title,callback:function(e){t.$set(t.pubForm,"title",e)},expression:"pubForm.title"}})],1),e("el-form-item",{attrs:{label:"文章分类",prop:"cate_id"}},[e("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择分类"},model:{value:t.pubForm.cate_id,callback:function(e){t.$set(t.pubForm,"cate_id",e)},expression:"pubForm.cate_id"}},t._l(t.cateList,(function(t){return e("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})})),1)],1),e("el-form-item",{attrs:{label:"文章内容",prop:"content"}},[e("quill-editor",{model:{value:t.pubForm.content,callback:function(e){t.$set(t.pubForm,"content",e)},expression:"pubForm.content"}})],1),e("el-form-item",{attrs:{label:"文章封面"}},[e("img",{ref:"imgRef",staticClass:"cover-img",attrs:{src:s(2921),alt:""}}),e("br"),e("input",{ref:"iptFileRef",staticStyle:{display:"none"},attrs:{type:"file",accept:"image/*"},on:{change:t.onCoverChangeFn}}),e("el-button",{attrs:{type:"text"},on:{click:t.chooseImgFn}},[t._v("+ 选择封面")])],1),e("el-form-item",[e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.pubArticleFn("已发布")}}},[t._v("发布")]),e("el-button",{attrs:{type:"info"},on:{click:function(e){return t.pubArticleFn("草稿")}}},[t._v("存为草稿")])],1)],1)],1),e("el-dialog",{attrs:{title:"文章预览",visible:t.detailVisible,width:"80%"},on:{"update:visible":function(e){t.detailVisible=e}}},[e("h1",{staticClass:"title"},[t._v(t._s(t.title))]),e("div",{staticClass:"info"},[e("span",[t._v("作者："+t._s(t.nickname||t.username))]),e("span",[t._v("发布时间："+t._s(t.$formatDate(t.pub_date)))]),e("span",[t._v("所属分类："+t._s(t.name))]),e("span",[t._v("状态："+t._s(t.state))])]),e("el-divider"),e("img",{attrs:{src:t.img,alt:""}}),e("div",{staticClass:"detail-box",domProps:{innerHTML:t._s(t.content)}})],1)],1)],1)},i=[],l=s(7877),n=s(4471),r=s(2921),o={name:"ArtList",data(){return{name:"",title:"",content:"",state:"",img:"",nickname:"",username:" ",pub_date:" ",q:{pagenum:1,pagesize:2,id:"",cate_id:"",state:""},pubDialogVisible:!1,pubForm:{title:"",pub_date:"2022-11-06 15:03:03",cate_id:"1",author_id:"4",id:"",content:"",cover_img:null,state:""},pubFormRules:{title:[{required:!0,message:"请输入文章标题",trigger:"blur"},{min:1,max:30,message:"文章标题的长度为1-30个字符",trigger:"blur"}],id:[{required:!0,message:"请选择文章标题",trigger:"blur"}],content:[{required:!0,message:"请输入文章内容",trigger:"blur"}]},cateList:[],artList:[],total:0,detailVisible:!1,artDetail:{},baseURL:n.v}},created(){this.initCateList(),this.initArtListFn()},methods:{getDateInfo(t){const e=t?new Date(t):new Date,s=e.getFullYear(),a=e.getMonth()+1,i=e.getDate(),l=s+"-"+a+"-"+i;return l},showPubDialogFn(){this.pubDialogVisible=!0},async handleClose(t){const e=await this.$confirm("此操作将导致文章信息丢失, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch((t=>t));"cancel"!==e&&t()},async initCateList(){console.log("date："+this.getDateInfo());const{data:t}=await(0,l.I2)();console.log("+++++++"),console.log(t.status),0===t.status&&(this.cateList=t.data,this.pubForm.cate_id=this.cateList.id)},chooseImgFn(){this.$refs.iptFileRef.click()},onCoverChangeFn(t){const e=t.target.files;if(0===e.length)this.pubForm.cover_img=null,this.$refs.imgRef.setAttribute("src",r);else{const t=new FileReader;t.readAsDataURL(e[0]),t.onload=t=>{this.pubForm.cover_img=t.target.result;const s=URL.createObjectURL(e[0]);this.$refs.imgRef.setAttribute("src",s),console.log("-------"),console.log(this.pubForm.cover_img)}}},pubArticleFn(t){this.pubForm.state=t,this.$refs.pubFormRef.validate((async t=>{if(!t)return this.$message.error("请完善文章信息！");if(!this.pubForm.cover_img)return this.$message.error("请选择文章封面！");const e=new FormData;Object.keys(this.pubForm).forEach((t=>{console.log(t+"："+this.pubForm[t]),e.append(t,this.pubForm[t]),console.log(e.get(t))})),this.pubForm.pub_date=this.getDateInfo(),console.log("请求");const{data:s}=await(0,l.Eg)(this.pubForm);if(0!==s.status)return this.$message.error("发布文章失败！");this.$message.success("发布文章成功！"),this.pubDialogVisible=!1,this.resetListFn()}))},onDialogClosedFn(){this.$refs.pubFormRef.resetFields(),this.$refs.imgRef.setAttribute("src",r)},async initArtListFn(){console.log("-----"+this.q);const{data:t}=await(0,l.Us)(this.q);if(0!==t.status)return this.$message.error("获取文章列表失败!");this.artList=t.data,console.log("total:"+this.artList),this.total=t.data.length},handleSizeChangeFn(t){this.q.pagesize=t,this.q.pagenum=1,this.initArtListFn()},handleCurrentChangeFn(t){this.q.pagenum=t,this.initArtListFn()},resetListFn(){this.q={pagenum:1,pagesize:2,id:"",state:""},this.initArtListFn()},async showDetailFn(t){console.log("title:"+t);const{data:e}=await(0,l.Qv)(t);if(console.log("status"+e.status),console.log(e.data),0!==e.status)return this.$message.error("获取文章详情失败!");0===e.status&&(this.artDetail=e.data),console.log(this.artDetail[0].name),this.name=this.artDetail[0].name,this.title=this.artDetail[0].title,this.content=this.artDetail[0].content,this.state=this.artDetail[0].state,this.img=this.artDetail[0].cover_img,this.username=this.artDetail[0].username,this.nickname=this.artDetail[0].nickname,this.pub_date=this.artDetail[0].pub_date,console.log(this.content),this.detailVisible=!0},async removeFn(t){const e=await this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch((t=>t));if("cancel"===e)return;const{data:s}=await(0,l.VT)(t);if(0!==s.status)return this.$message.error("删除失败!");0===s.status&&(this.$message.success("删除成功!"),this.resetListFn())}}},c=o,u=s(1001),p=(0,u.Z)(c,a,i,!1,null,"16657816",null),m=p.exports},2921:function(t,e,s){t.exports=s.p+"img/cover.54bfb07c.jpg"}}]);
//# sourceMappingURL=916.bd58ae9e.js.map